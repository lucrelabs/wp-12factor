!function(_,e){var c={cache:function(){c.els={},c.vars={},c.els.document=_(e),c.els.document_body=_(e.body),c.els.reservation_table=_(".jckwds-reserve"),c.els.reservation_table_rows=c.els.reservation_table.find("tr"),c.els.reservation_table_prev=_(".jckwds-prevday"),c.els.reservation_table_next=_(".jckwds-nextday"),c.els.date_picker=_("#jckwds-delivery-date"),c.els.date_ymd=_("#jckwds-delivery-date-ymd"),c.els.timeslot_select=_("#jckwds-delivery-time"),c.els.timeslot_select_wrapper=_("#jckwds-delivery-time-wrapper"),c.els.timeslot_field_row=_("#jckwds-delivery-time_field"),c.els.checkout_fields=_("#jckwds-fields"),c.els.fields_hidden=_('[name="iconic-wds-fields-hidden"]'),c.els.ship_to_different_address_checkbox=_("#ship-to-different-address-checkbox"),c.els.shipping_postcode_field=_("#shipping_postcode"),c.els.billing_postcode_field=_("#billing_postcode"),c.els.multi_step_checkout=_("#wizard"),c.els.calender_wrap=_(".jckwds-reserve-wrap"),c.vars.is_checkout=c.els.document_body.hasClass("woocommerce-checkout")||c.els.document_body.hasClass("checkout-wc"),c.vars.has_multi_step=0<c.els.multi_step_checkout.length,c.vars.inactive_class="jckwds-fields-inactive",c.vars.chosen_shipping_method=!1,c.vars.block_checkout_index=0,c.vars.set_date_flag=!1},on_load:function(){c.cache(),c.setup_reservation_table(),c.setup_checkout(),c.setup_multi_step_checkout()},setup_reservation_table:function(){c.els.reservation_table.length<=0||(c.setup_prev_next(),c.setup_reserve_button(),c.load_reserved_slot())},load_reserved_slot:function(){if(0===c.els.calender_wrap.length)return!1;c.els.calender_wrap.block({message:null,overlayCSS:{opacity:.6}});jQuery.post(jckwds_vars.ajax_url,{action:"iconic_wds_get_reserved_slot"},function(e){e.success&&(_(".jckwds-reserved").removeClass("jckwds-reserved"),_('[data-timeslot-id="'+e.data.id+'"]').addClass("jckwds-reserved")),c.els.calender_wrap.unblock()})},setup_checkout:function(){c.vars.is_checkout&&!c.vars.has_multi_step&&(c.setup_checkout_fields(),c.watch_update_checkout())},setup_multi_step_checkout:function(){c.vars.is_checkout&&c.vars.has_multi_step&&c.els.multi_step_checkout.init(function(){c.cache(),c.setup_checkout_fields(),c.watch_update_checkout()})},setup_prev_next:function(){c.els.reservation_table_prev.on("click",function(){return _.each(c.els.reservation_table_rows,function(){var e=_(this).find(".colVis:first").index();1!==e&&(_(this).children().eq(e-1).addClass("colVis"),_(this).find(".colVis:last").removeClass("colVis"))}),!1}),c.els.reservation_table_next.on("click",function(){_(".jckwds-reserve thead tr .colVis:last").index(),_(".jckwds-reserve thead tr .colVis:first").index();return _.each(c.els.reservation_table_rows,function(){var e=_(this).find(".colVis:last").index();e+1<_(this).children().length&&(_(this).children().eq(e+1).addClass("colVis"),_(this).find(".colVis:first").removeClass("colVis"))}),!1})},setup_reserve_button:function(){c.els.document.on("click",".jckwds-reserve-slot",function(){return c.activate_slot(_(this)),!1})},activate_slot:function(e){var t=e.parent(),a=t.html(),i=t.attr("data-timeslot-id"),d=t.attr("data-timeslot-date"),r=t.attr("data-timeslot-start-time"),o=t.attr("data-timeslot-end-time"),s=(e.closest(".jckwds-reserve-wrap"),{action:"iconic_wds_remove_reserved_slot",nonce:jckwds_vars.ajax_nonce});e.hide().after('<div class="jckwds_loading"><i class="jckwds-icn-loading animate-spin"></i></div>'),jQuery.post(jckwds_vars.ajax_url,s,function(e){var s;e.success&&(c.els.document_body.trigger("reservation_removed"),s={action:"iconic_wds_reserve_slot",nonce:jckwds_vars.ajax_nonce,slot_id:i,slot_date:d,slot_start_time:r,slot_end_time:o},jQuery.post(jckwds_vars.ajax_url,s,function(e){_("td.jckwds-reserved").removeClass("jckwds-reserved"),e.success?t.addClass("jckwds-reserved").html(a):t.addClass("jckwds_full").html('<i class="jckwds-icn-lock"></i>'),c.els.document_body.trigger("reservation_added",e)}))})},setup_checkout_fields:function(){c.setup_date_picker(),c.setup_timeslot_select()},setup_date_picker:function(){c.els.date_picker.datepicker({defaultDate:jckwds_vars.bookable_dates[0],minDate:jckwds_vars.bookable_dates[0],beforeShow:function(e,s){var t=0<=_.inArray(jckwds_vars.settings.datesettings_datesettings_setup_uitheme,["none","dark","light"])?jckwds_vars.settings.datesettings_datesettings_setup_uitheme:"dark";s.dpDiv.addClass("iconic-wds-datepicker iconic-wds-datepicker--"+t)},beforeShowDay:function(e){var s=_.datepicker.formatDate(jckwds_vars.settings.datesettings_datesettings_dateformat,e,{monthNames:jckwds_vars.strings.months,monthNamesShort:jckwds_vars.strings.months_short,dayNames:jckwds_vars.strings.days,dayNamesShort:jckwds_vars.strings.days_short,dayNamesMin:jckwds_vars.strings.days_short}).toString(),t="iconic-wds-date";if(c.is_date_available(s)){var a=c.get_fee_for_date(e);return a&&(t+=" iconic-wds-date--fee"),[!0,t,a?jckwds_vars.strings.available+": +"+a:jckwds_vars.strings.available]}return[!1,t,jckwds_vars.strings.unavailable]},dateFormat:jckwds_vars.settings.datesettings_datesettings_dateformat,onSelect:function(e,s){var t;_(this).trigger("change"),""!==this.value&&(t=[c.pad_left(s.selectedYear,4),c.pad_left(s.selectedMonth+1,2),c.pad_left(s.selectedDay,2)].join(""),c.els.date_ymd.val(t),c.vars.set_date_flag?c.vars.set_date_flag=!1:c.is_true(jckwds_vars.settings.timesettings_timesettings_setup_enable)?c.update_timeslot_options(t):c.els.document_body.trigger("update_checkout"))},monthNames:jckwds_vars.strings.months,monthNamesShort:jckwds_vars.strings.months_short,dayNames:jckwds_vars.strings.days,dayNamesShort:jckwds_vars.strings.days_short,dayNamesMin:jckwds_vars.strings.days_short,firstDay:c.get_first_day_of_the_week(),duration:0}),_.datepicker.setDefaults(_.datepicker.regional[""]),c.els.date_picker.datepicker(_.datepicker.regional[""]),_(".ui-datepicker").addClass("notranslate")},is_true:function(e){return!(!e||0===e||"0"===e||""===e||e.length<=0)},get_fee_for_date:function(e){var s=e.getDay(),t=parseFloat(jckwds_vars.settings.datesettings_fees_days[s]),a=_.datepicker.formatDate(jckwds_vars.settings.datesettings_datesettings_dateformat,e,{monthNames:jckwds_vars.strings.months,monthNamesShort:jckwds_vars.strings.months_short,dayNames:jckwds_vars.strings.days,dayNamesShort:jckwds_vars.strings.days_short,dayNamesMin:jckwds_vars.strings.days_short}).toString();return a===jckwds_vars.dates.same_day&&0<jckwds_vars.settings.datesettings_fees_same_day.length&&(t+=parseFloat(jckwds_vars.settings.datesettings_fees_same_day)),a===jckwds_vars.dates.next_day&&0<jckwds_vars.settings.datesettings_fees_next_day.length&&(t+=parseFloat(jckwds_vars.settings.datesettings_fees_next_day)),!isNaN(t)&&accounting.formatMoney(t,jckwds_vars.currency)},set_date:function(e){if(e.length<=0||!c.is_date_available(e,!1))return c.els.date_picker.blur().datepicker("hide").datepicker("setDate",null),c.els.date_ymd.val(""),void c.clear_timeslots(jckwds_vars.strings.selectdate);c.vars.set_date_flag=!0,e=_.datepicker.parseDate(jckwds_vars.settings.datesettings_datesettings_dateformat,e,{monthNames:jckwds_vars.strings.months,monthNamesShort:jckwds_vars.strings.months_short,dayNames:jckwds_vars.strings.days,dayNamesShort:jckwds_vars.strings.days_short,dayNamesMin:jckwds_vars.strings.days_short}),c.els.date_picker.blur().datepicker("hide").datepicker("setDate",e),_(".ui-datepicker .ui-state-active").click()},is_date_available:function(t){if(jckwds_vars.bookable_dates.length<=0)return!1;var a=!1;return t=t.toLowerCase(),_.each(jckwds_vars.bookable_dates,function(e,s){if(!1===a&&s.toLowerCase()===t)return!(a=!0)}),a},update_timeslot_options:function(e,s){var t=c.els.timeslot_select.find("option:eq(0)"),a=c.els.timeslot_select.val(),i=c.els.ship_to_different_address_checkbox.is(":checked")?_("#shipping_postcode").val():_("#billing_postcode").val();c.clear_timeslots(jckwds_vars.strings.loading),c.els.timeslot_select.attr("disabled","disabled").trigger("change",["update_timeslots"]);var d={action:"iconic_wds_get_slots_on_date",nonce:jckwds_vars.ajax_nonce,date:e,postcode:i};jQuery.post(jckwds_vars.ajax_url,d,function(e){!0===e.success?(c.clear_timeslots(jckwds_vars.strings.selectslot),c.els.timeslot_select.append(e.html),a=0<c.els.timeslot_select.find('option[value="'+a+'"]').length?a:0,c.els.timeslot_select.val(a),e.reservation&&0<c.els.timeslot_select.find("option[value='"+e.reservation+"']").length&&c.els.timeslot_select.val(e.reservation),c.els.document_body.trigger("update_checkout")):t.text(jckwds_vars.strings.noslots),c.els.document_body.trigger("timeslots_loaded"),c.els.timeslot_select.removeAttr("disabled").trigger("change",["update_timeslots"]),void 0!==s&&s(e)})},refresh_timeslots:function(e){var s;e=void 0!==e&&e,c.els.timeslot_field_row.hasClass("jckwds-delivery-time--has-reservation")&&!1===e?c.els.timeslot_field_row.removeClass("jckwds-delivery-time--has-reservation"):(void 0!==(s=c.els.date_ymd.val())&&""!==s&&c.update_timeslot_options(s),c.els.document_body.trigger("timeslots_refreshed"))},clear_date:function(){c.els.date_ymd.val(""),c.set_date("")},clear_timeslots:function(e){c.els.timeslot_select.children().not(":first").remove(),"string"==typeof e&&c.els.timeslot_select.find("option:eq(0)").text(e)},setup_timeslot_select:function(){c.els.timeslot_select.on("change",function(e,s){"update_timeslots"!==(s=void 0!==s&&s)&&c.els.document_body.trigger("update_checkout")})},watch_update_checkout:function(){c.els.document_body.on("update_checkout",function(e){c.block_checkout()}),c.els.document_body.on("updated_checkout",function(e,s){c.update_checkout_field_labels(s.fragments.iconic_wds.labels),s.fragments.iconic_wds.chosen_shipping_method!==c.vars.chosen_shipping_method?(c.vars.chosen_shipping_method=s.fragments.iconic_wds.chosen_shipping_method.toString(),c.toggle_date_time_fields(function(e,s){e&&c.refresh_datepicker(s.bookable_dates,function(){c.refresh_timeslots(!0)}),c.unblock_checkout(s.index)})):c.unblock_checkout(!0)}),c.els.checkout_fields.hasClass(c.vars.inactive_class)&&c.hide_date_time_fields()},block_checkout:function(){c.vars.block_checkout_index++,c.els.checkout_fields.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),_("#place_order").attr("disabled","disabled")},unblock_checkout:function(e){!0!==e&&e!==c.vars.block_checkout_index||(c.els.checkout_fields.unblock({fadeOut:0}),_("#place_order").removeAttr("disabled"))},update_checkout_field_labels:function(e){var a;e.length<=0||(a={details:_(".iconic-wds-fields__title"),date:_(".jckwds-delivery-date label"),select_date:_("#jckwds-delivery-date"),choose_date:_("#jckwds-delivery-date-description"),time_slot:_(".jckwds-delivery-time label"),choose_time_slot:_(" #jckwds-delivery-time-description")},_.each(e,function(e,s){if(void 0===a[e])return!0;if(a[e].is("input"))return a[e].attr("placeholder",s),!0;var t=a[e].find("*");a[e].text(s),0<t.length&&a[e].append("&nbsp;").append(t)}))},refresh_datepicker:function(e,s){var t;jckwds_vars.bookable_dates=e,c.els.date_picker.blur().datepicker("hide").datepicker("option","defaultDate",e[0]).datepicker("option","minDate",e[0]),jckwds_vars.reserved_slot?-1!==_.inArray(jckwds_vars.reserved_slot.date.formatted,jckwds_vars.bookable_dates)&&c.set_date(jckwds_vars.reserved_slot.date.formatted):(t=c.els.date_picker.val(),c.set_date(t)),void 0!==s&&s()},clear_date_time_fields:function(){c.clear_date(),c.clear_timeslots()},toggle_date_time_fields:function(t){if(_.inArray("any",jckwds_vars.settings.general_setup_shipping_methods)<0&&_.inArray(c.vars.chosen_shipping_method,jckwds_vars.settings.general_setup_shipping_methods)<0)return c.hide_date_time_fields(),void("function"==typeof t&&t(!1,{index:!0}));c.show_date_time_fields(),c.is_delivery_slots_allowed(function(e,s){e?c.show_date_time_fields():c.hide_date_time_fields(),"function"==typeof t&&t(e,s)})},hide_date_time_fields:function(){c.els.checkout_fields.removeClass(c.vars.inactive_class).removeClass("woocommerce-billing-fields").hide(),c.els.fields_hidden.val(1),c.clear_date_time_fields()},show_date_time_fields:function(){c.els.checkout_fields.addClass("woocommerce-billing-fields").show(),c.els.fields_hidden.val(0)},is_delivery_slots_allowed:function(s){var e={action:"iconic_wds_is_delivery_slots_allowed",index:c.vars.block_checkout_index};_.post(jckwds_vars.ajax_url,e,function(e){"function"==typeof s&&s(e.success,e.data)})},get_last_day_of_the_week:function(){var e={monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6,sunday:0};return void 0===jckwds_vars.settings.datesettings_datesettings_last_day_of_week||void 0===e[jckwds_vars.settings.datesettings_datesettings_last_day_of_week]?6:e[jckwds_vars.settings.datesettings_datesettings_last_day_of_week]},get_first_day_of_the_week:function(){var e=c.get_last_day_of_the_week();return 6===e?0:e+1},pad_left:function(e,s,t){return new Array(s-String(e).length+1).join(t||"0")+e},checkout_error:function(){var e=_('[data-iconic-wds-clear-date="1"]'),s=_('[data-iconic-wds-clear-time="1"]');e.length<=0&&s.length<=0||(0<e.length&&c.clear_date(),0<s.length&&c.refresh_timeslots(!0))}};_(window).load(c.on_load),_(e.body).on("checkout_error",c.checkout_error)}(jQuery,document);